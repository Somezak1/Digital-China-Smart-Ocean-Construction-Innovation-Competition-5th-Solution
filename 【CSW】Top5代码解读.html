<html>
<head>
  <title>【CSW】Top5代码解读</title>
  <basefont face="微软雅黑 Light" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605766 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑 Light;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="11732"/>
<h1>【CSW】Top5代码解读</h1>

<div>
<span><div><div><br/></div><div><span>    </span><span>    </span>data_label 的每行都是一艘船舶捕鱼时序活动的初始帧，即行1：船A时序数据的起始帧；行2：船B时序数据的起始帧；行3：船C时序数据的起始帧。列为<span style="color: unset; font-family: unset; font-size: unset;">【“ship”，“x</span><span style="color: unset; font-family: unset; font-size: unset;">”，“y”，“</span><span style="color: unset; font-family: unset; font-size: unset;">speed</span><span style="color: unset; font-family: unset; font-size: unset;">”，“</span><span style="color: unset; font-family: unset; font-size: unset;">direction</span><span style="color: unset; font-family: unset; font-size: unset;">”，“</span><span style="color: unset; font-family: unset; font-size: unset;">time</span><span style="color: unset; font-family: unset; font-size: unset;">”，“</span><span style="color: unset; font-family: unset; font-size: unset;">type</span><span style="color: unset; font-family: unset; font-size: unset;">”】。在 </span>data_label 的基础上生成下面特征。</div><div><br/></div><div>        根据 “time” 生成日期 “date”、小时 “hour”、白天&amp;夜里 “day_nig” 特征</div><div><br/></div><div>        根据 “x” 和 “y” 计算当前时刻船舶位置坐标相对原点的绝对距离 “base_dis_diff”，再分别对 “x” 和 “y” 除以1e6</div><div><br/></div><div>        根据每条船 “speed” == 0 的这部分时序数据，为每条船生成如下特征：</div><ul><ul><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.1    “direction” 的【“max”，“median”， “mean”， “std”， “skew”】</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">2    </span><span style="font-size: unset; color: unset; font-family: unset;">“x” 的【“max”，“min”，“median”， “mean”， “std”， “skew”】</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">3    </span><span style="font-size: unset; color: unset; font-family: unset;">“y” 的【“max”，“min”，“median”， “mean”， “std”， “skew”】</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">4    “base_dis_diff” 的【“max”，“min”， “mean”， “std”， “skew”】</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">5    同期的 </span><span style="font-size: unset; color: unset; font-family: unset;">“x_max” - “x_min”</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">6    </span><span style="font-size: unset; color: unset; font-family: unset;">同期的 </span><span style="font-size: unset; color: unset; font-family: unset;">“y_max” - “y_min”</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">7   </span> <span style="font-size: unset; color: unset; font-family: unset;">同期的 </span><span style="font-size: unset; color: unset; font-family: unset;">“y_max” - “x_min”</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">8   </span> <span style="font-size: unset; color: unset; font-family: unset;">同期的 </span><span style="font-size: unset; color: unset; font-family: unset;">“x_max” - “y_min”</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">9   </span> <span style="font-size: unset; color: unset; font-family: unset;">同期的 </span><span style="font-size: unset; color: unset; font-family: unset;">“y_median” / “x_median”  # 斜率 ”</span><span style="font-size: unset; color: unset; font-family: unset;">slope_median</span><span style="font-size: unset; color: unset; font-family: unset;">“</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">10    </span><span style="font-size: unset; color: unset; font-family: unset;">同期的</span><span style="font-size: unset; color: unset; font-family: unset;"> （“y_max” - “y_min”）/（“x_max” - “x_min”）  # 斜率 ”</span><span style="font-size: unset; color: unset; font-family: unset;">slope</span><span style="font-size: unset; color: unset; font-family: unset;">“</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">11    </span><span style="font-size: unset; color: unset; font-family: unset;">同期的 </span><span style="font-size: unset; color: unset; font-family: unset;">（“y_max” - “y_min”）*（“x_max” - “x_min”）  # 面积 ”</span><span style="font-size: unset; color: unset; font-family: unset;">area</span><span style="font-size: unset; color: unset; font-family: unset;">“</span></div></li><li><div><span style="font-size: unset; color: unset; font-family: unset;">A.</span><span style="font-size: unset; color: unset; font-family: unset;">12    该船出现频次最高的 “hour”</span></div></li></ul></ul><div><br/></div><div>        根据每条船 “speed” != 0 的这部分时序数据，为每条船生成如下特征：</div><ul><ul><li><div>B.1    “speed” 的【“max”，“median”， “mean”， “std”， “skew”，“nunique”】</div></li><li><div>B.2    “direction” 的【“max”，“median”， “mean”， “std”， “skew”，“nunique”】</div></li><li><div>B.n    同A.2-A.12</div></li></ul></ul><div><br/></div><div>        根据每条船 “day_night” == 0 的这部分时序数据，为每条船生成如下特征：</div><ul><ul><li><div>C.1    “speed” 的【“max”，“median”， “mean”， “std”， “skew”】</div></li><li><div>C.n    同A.2-A.12</div></li></ul></ul><div><br/></div><div>        根据每条船 “day_night” == 1 的这部分时序数据，为每条船生成如下特征：</div><ul><ul><li><div>D.1    “speed” 的【“max”，“median”， “mean”， “std”， “skew”】</div></li><li><div>D.n    <span style="font-size: unset; color: unset; font-family: unset;">同A.2-A.12</span></div></li></ul></ul><div><br/></div><div style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: rgb(51, 51, 51); border-radius: 4px; background-color: rgb(251, 250, 248); border: 1px solid rgba(0, 0, 0, 0.15);-en-codeblock:true;"><div><font style="font-size: 12pt;">def get_topic_vector(feature, ngram):</font></div><div><font style="font-size: 12pt;">    从每条船对应的</font><b><font style="font-size: 12pt;">feature</font></b><font style="font-size: 12pt;">时</font><font style="font-size: 12pt;">序数据中提取出出现频次最高的两个值v1和v2，将所有船的v1和v2汇聚在一起得到v_list，若v_list中有某个值v出现频率大于50%，则将其列为停止词。由此可以得到每条船去除停止词后的feature序列，将这些序列使用ngram=<b>ngram</b>的TF-IDF表示，则每条船的feature序列可以表达成一个稀疏向量，进而使用NMS矩阵分解算法提取出该船对应各个主题的概率分布向量，使用该主题概率分布向量就可以表征该船舶</font></div><div><font style="font-size: 12pt;">    return 该主题概率分布向量</font></div><div><font style="font-size: 12pt;"><br/></font></div><div><font style="font-size: 12pt;">for ngram in [1, 2, 3]:</font></div><div><font style="font-size: 12pt;">    for feature in [&quot;speed&quot;, &quot;x&quot;, &quot;y&quot;]:</font></div><div><font style="font-size: 12pt;">        get_topic_vector(feature, ngram)  # 为每条船生成八维主题概率分布向量表征该船舶</font></div></div><div><br/></div><div><span>    </span><span>    </span>用该船 “speed” != 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”direction_median“ / </span>该船 “speed” == 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”direction_median“</span></div><div><span>    </span><span>    </span>用该船 “speed” != 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>slope<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“ / </span>该船 “speed” == 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>slope<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“</span></div><div><span>    </span><span>    </span>用该船 “speed” != 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>slope_median<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“ / </span>该船 “speed” == 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>slope_median<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“</span></div><div><span>    </span><span>    </span>用该船 “day_night” == 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>speed_median<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“ / </span>该船 “day_night” == 1 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>speed_median<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“</span></div><div><span>    </span><span>    </span>用该船 “day_night” == 0 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>speed_std<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“ / </span>该船 “day_night” == 1 时序数据计算出来的 <span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">”</span>speed_std<span style="color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-size: medium; font-variant-ligatures: normal; font-variant-caps: normal; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">“</span></div><div><br/></div><div><span>    </span><span>    </span>根据每条船的 “direction”，生成等于该 “direction” 的 “ship” 数量</div><div><span>    </span><span>    </span>根据每条船的 “speed”，生成等于该 “speed” 的 “ship” 数量</div><div><br/></div><div><span>    </span><span>    </span>根据 “speed” == 0 时序数据计算出来的每条船的 ”slope_median“，生成等于该 ”slope_median“ 的所有船 “speed” 的【“max”，“min”， “median”， “std”， “skew”】</div><div><span>    </span><span>    </span>根据 “speed” == 1 时序数据计算出来的每条船的 ”slope_median“，生成等于该 ”slope_median“ 的所有船 “speed” 的【“max”，“min”， “median”， “std”， “skew”】</div><div><span>    </span><span>    </span>根据 “speed” == 1 时序数据计算出来的每条船的 “speed_nunique”，生成等于该 “speed_nunique” 的 “ship” 数量</div><div><span>    </span><span>    </span>根据 “speed” == 1 时序数据计算出来的每条船的 “direction_nunique”，生成等于该 “direction_nunique” 的 “ship” 数量</div><div><br/></div><div><span>    </span><span>    </span>根据所有船的时序数据中的 “x”，将 “x” 按分位数<b>临时</b>分桶成199个整数值 “x_cate”</div><div><span>    </span><span>    </span>根据所有船的时序数据中的 “y”，将 “y” 按分位数<b>临时</b>分桶成199个整数值 “y_cate”</div><div><span>    </span><span>    </span>根据所有船的时序数据中的 “base_dis_diff”，将 “base_dis_diff” 按分位数<b>临时</b>分桶成199个整数值 “distance_cate”</div><div><span>    </span><span>    </span>根据所有船的时序数据中的 “speed”，将 “speed” 按<b>临时</b>分位数分桶成199个整数值 “speed_cate”</div><div><span>    </span><span>    </span>for emb_cols in [“x_cate”，“y_cate”，“distance_cate”，“speed_cate”]：</div><div>        <span>    </span><span>    </span>generate_embeddings(emb_cols)  # 以 “x_cate” 举例，每条船的 “x_cate” 序列可以作为sentence，每个时刻的 “x_cate” 可以作为word，使用word2vec的CBOW算法无监督训练，可以得到每个时刻 “x_cate” 对应的embedding向量，因此可以用其 “x_cate” 序列中 “x_cate” 对应embedding的平均来表示一条船</div><div><br/></div><div><span style="color: unset; font-family: unset; font-size: unset;"><span>    </span><span>    </span>最后删除【“ship”，“x</span><span style="color: unset; font-family: unset; font-size: unset;">”，“y”，“</span><span style="color: unset; font-family: unset; font-size: unset;">speed</span><span style="color: unset; font-family: unset; font-size: unset;">”，“</span><span style="color: unset; font-family: unset; font-size: unset;">direction</span><span style="color: unset; font-family: unset; font-size: unset;">”，“</span><span style="color: unset; font-family: unset; font-size: unset;">time</span><span style="color: unset; font-family: unset; font-size: unset;">”，“</span><span style="color: unset; font-family: unset; font-size: unset;">type</span><span style="color: unset; font-family: unset; font-size: unset;">”，</span>“date”，“hour”，“day_nig”<span style="color: unset; font-family: unset; font-size: unset;">】</span></div><div><br/></div><div><br/></div></div></span>
</div></body></html> 